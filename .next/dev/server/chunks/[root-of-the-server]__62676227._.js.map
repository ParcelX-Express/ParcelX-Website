{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/workspace/pages/api/track.js"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_KEY || process.env.SUPABASE_SERVICE_ROLE_KEY;\n\nexport default async function handler(req, res) {\n  if (req.method !== 'POST') {\n    return res.status(405).json({ error: 'Method not allowed' });\n  }\n\n  const { tracking_number } = req.body;\n\n  if (!tracking_number || typeof tracking_number !== 'string') {\n    return res.status(400).json({ error: 'Tracking number is required' });\n  }\n\n  const cleanTrackingNumber = tracking_number.trim().toUpperCase();\n\n  if (cleanTrackingNumber.length < 3 || cleanTrackingNumber.length > 50) {\n    return res.status(400).json({ error: 'Invalid tracking number format' });\n  }\n\n  if (!supabaseServiceKey) {\n    return res.status(500).json({ error: 'Server configuration error' });\n  }\n\n  try {\n    const supabase = createClient(supabaseUrl, supabaseServiceKey);\n\n    const { data: shipment, error: shipmentError } = await supabase\n      .from('shipments')\n      .select('id, tracking_number, status, origin, destination, estimated_delivery, created_at, updated_at')\n      .eq('tracking_number', cleanTrackingNumber)\n      .single();\n\n    if (shipmentError || !shipment) {\n      return res.status(404).json({ error: 'Shipment not found' });\n    }\n\n    const { data: updates } = await supabase\n      .from('tracking_updates')\n      .select('id, location, description, status, occurrence_time')\n      .eq('shipment_id', shipment.id)\n      .order('occurrence_time', { ascending: false });\n\n    return res.status(200).json({\n      shipment: {\n        tracking_number: shipment.tracking_number,\n        status: shipment.status,\n        origin: shipment.origin,\n        destination: shipment.destination,\n        estimated_delivery: shipment.estimated_delivery,\n        updated_at: shipment.updated_at\n      },\n      tracking_updates: updates || []\n    });\n  } catch (error) {\n    console.error('Track API error:', error);\n    return res.status(500).json({ error: 'An error occurred' });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,MAAM;AACN,MAAM,qBAAqB,QAAQ,GAAG,CAAC,oBAAoB,IAAI,QAAQ,GAAG,CAAC,yBAAyB;AAErF,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAqB;IAC5D;IAEA,MAAM,EAAE,eAAe,EAAE,GAAG,IAAI,IAAI;IAEpC,IAAI,CAAC,mBAAmB,OAAO,oBAAoB,UAAU;QAC3D,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAA8B;IACrE;IAEA,MAAM,sBAAsB,gBAAgB,IAAI,GAAG,WAAW;IAE9D,IAAI,oBAAoB,MAAM,GAAG,KAAK,oBAAoB,MAAM,GAAG,IAAI;QACrE,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAiC;IACxE;IAEA,IAAI,CAAC,oBAAoB;QACvB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAA6B;IACpE;IAEA,IAAI;QACF,MAAM,WAAW,IAAA,2OAAY,EAAC,aAAa;QAE3C,MAAM,EAAE,MAAM,QAAQ,EAAE,OAAO,aAAa,EAAE,GAAG,MAAM,SACpD,IAAI,CAAC,aACL,MAAM,CAAC,gGACP,EAAE,CAAC,mBAAmB,qBACtB,MAAM;QAET,IAAI,iBAAiB,CAAC,UAAU;YAC9B,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAqB;QAC5D;QAEA,MAAM,EAAE,MAAM,OAAO,EAAE,GAAG,MAAM,SAC7B,IAAI,CAAC,oBACL,MAAM,CAAC,sDACP,EAAE,CAAC,eAAe,SAAS,EAAE,EAC7B,KAAK,CAAC,mBAAmB;YAAE,WAAW;QAAM;QAE/C,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAC1B,UAAU;gBACR,iBAAiB,SAAS,eAAe;gBACzC,QAAQ,SAAS,MAAM;gBACvB,QAAQ,SAAS,MAAM;gBACvB,aAAa,SAAS,WAAW;gBACjC,oBAAoB,SAAS,kBAAkB;gBAC/C,YAAY,SAAS,UAAU;YACjC;YACA,kBAAkB,WAAW,EAAE;QACjC;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAoB;IAC3D;AACF"}}]
}